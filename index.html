<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum Kedisiplinan Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800 mb-2">üìã Forum Kedisiplinan</h1>
            <p class="text-gray-600">Sistem Monitoring Pelanggaran Siswa</p>
        </div>

        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg shadow-md p-1 flex flex-wrap justify-center">
                <button onclick="showTab('public')" id="publicTab" class="px-6 py-2 rounded-md font-medium transition-all bg-indigo-500 text-white">
                    üë• Data Publik
                </button>
                <button onclick="showTab('teacher')" id="teacherTab" class="px-6 py-2 rounded-md font-medium transition-all text-gray-600 hover:text-indigo-600">
                    üë®‚Äçüè´ Akses Guru
                </button>
                <button onclick="showTab('recap')" id="recapTab" class="px-6 py-2 rounded-md font-medium transition-all text-gray-600 hover:text-indigo-600">
                    üìä Rekap Detail
                </button>
                
                <button onclick="showTab('rules')" id="rulesTab" class="px-6 py-2 rounded-md font-medium transition-all text-gray-600 hover:text-indigo-600">
                    üìú Tata Tertib
                </button>
                
            </div>
        </div>

        <div id="publicSection" class="fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìä Data Poin Pelanggaran Siswa</h2>
                <div class="mb-4">
                    <input type="text" id="searchInput" onkeyup="renderStudentTable()" placeholder="Ketuk untuk mencari nama siswa..." class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-indigo-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-indigo-800">Nama Siswa</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-indigo-800">Kelas</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-indigo-800">Total Poin</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-indigo-800">Status</th>
                            </tr>
                        </thead>
                        <tbody id="studentTable"></tbody>
                    </table>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">üìã Kategori Status</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center space-x-2">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Baik</span>
                        <span class="text-gray-600">0-10 poin</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">Peringatan</span>
                        <span class="text-gray-600">11-20 poin</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">Bermasalah</span>
                        <span class="text-gray-600">21+ poin</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="teacherSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üîê Akses Guru</h2>
                <div id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kode Akses Guru</label>
                        <input type="password" id="teacherCode" placeholder="Masukkan kode akses" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button onclick="verifyTeacher()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-indigo-700 transition-colors">
                        üîì Masuk
                    </button>
                </div>
                <div id="teacherPanel" class="hidden space-y-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <p class="text-green-800 font-medium">‚úÖ Berhasil masuk sebagai guru</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Siswa</label>
                        <select id="studentSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">-- Pilih Siswa --</option>
                        </select>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Jenis Pelanggaran</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="addViolation('Terlambat', 2)" class="bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-yellow-800">‚è∞ Terlambat</div>
                                <div class="text-sm text-yellow-600">+2 poin</div>
                            </button>
                            <button onclick="addViolation('Tidak Mengerjakan PR', 3)" class="bg-orange-100 hover:bg-orange-200 border-2 border-orange-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-orange-800">üìö Tidak Mengerjakan PR</div>
                                <div class="text-sm text-orange-600">+3 poin</div>
                            </button>
                            <button onclick="addViolation('Tidak Berseragam', 5)" class="bg-red-100 hover:bg-red-200 border-2 border-red-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-red-800">üëî Tidak Berseragam</div>
                                <div class="text-sm text-red-600">+5 poin</div>
                            </button>
                            <button onclick="addViolation('Mengganggu Kelas', 4)" class="bg-purple-100 hover:bg-purple-200 border-2 border-purple-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-purple-800">üó£Ô∏è Mengganggu Kelas</div>
                                <div class="text-sm text-purple-600">+4 poin</div>
                            </button>
                            <button onclick="addViolation('Merokok', 10)" class="bg-red-200 hover:bg-red-300 border-2 border-red-400 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-red-900">üö≠ Merokok</div>
                                <div class="text-sm text-red-700">+10 poin</div>
                            </button>
                            <button onclick="addViolation('Berkelahi', 15)" class="bg-red-300 hover:bg-red-400 border-2 border-red-500 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-red-900">üëä Berkelahi</div>
                                <div class="text-sm text-red-800">+15 poin</div>
                            </button>
                        </div>
                    </div>
                    <button onclick="logout()" class="w-full bg-gray-500 text-white py-3 px-6 rounded-lg font-medium hover:bg-gray-600 transition-colors">
                        üö™ Keluar
                    </button>
                </div>
            </div>
        </div>

        <div id="recapSection" class="hidden">
            <div id="recapDetailContent" class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">üìä Rekap Detail Seluruh Siswa</h2>
                <p class="text-gray-600 mb-6">Tabel ini menampilkan data poin dan detail pelanggaran untuk semua siswa. Gunakan tombol di bawah untuk mengunduh sebagai file Excel (CSV).</p>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Nama Siswa</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Kelas</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold">Total Poin</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold">Status</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Detail Pelanggaran</th>
                            </tr>
                        </thead>
                        <tbody id="recapDetailTableBody"></tbody>
                    </table>
                </div>
            </div>
            <button onclick="downloadRecapAsExcel()" class="mt-6 w-full bg-green-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-green-700 transition-colors">
                üì• Unduh Rekap Detail (Excel)
            </button>
        </div>

        <div id="rulesSection" class="hidden fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 md:p-10">

                <header class="text-center mb-10 pb-4 border-b">
                    <h1 class="text-3xl font-bold text-gray-900">Tata Tertib</h1>
                    <h2 class="text-2xl font-semibold text-gray-700">SMA 1 Simanjaya</h2>
                    <p class="text-lg text-gray-500">Tahun Pelajaran 2025/2026</p>
                </header>

                <section class="bg-blue-600 text-white p-6 rounded-lg text-center mb-10 shadow-md">
                    <h3 class="text-2xl font-bold">Jargon SMA 1 Simanjaya</h3>
                    <p class="text-xl mt-2 font-light">"Siap BHISA, Siap DISIPLIN, Siap JUARA..."</p>
                </section>

                <section class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-200 pb-2 mb-4">Jenis Pelanggaran</h3>
                    <ul class="list-decimal list-inside bg-gray-50 p-6 rounded-lg space-y-2 text-gray-700">
                        <li>Pakaian Seragam</li>
                        <li>Rambut, Kuku, Tato, Make Up</li>
                        <li>Masuk dan Pulang Sekolah</li>
                        <li>Kebersihan, Kedisiplinan dan Ketertiban</li>
                        <li>Sopan Santun Pergaulan</li>
                        <li>Upacara Bendera dan Peringatan Hari Besar</li>
                        <li>Kegiatan Keagamaan</li>
                        <li>Larangan-larangan</li>
                    </ul>
                </section>

                <section class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-200 pb-2 mb-4">Petugas yang Mencatat Pelanggaran</h3>
                    <ul class="list-disc list-inside bg-gray-50 p-6 rounded-lg space-y-2 text-gray-700">
                        <li>Petugas Ketertiban</li>
                        <li>Guru Piket</li>
                        <li>Wali Kelas</li>
                        <li>Semua Guru</li>
                    </ul>
                </section>

                <section class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-200 pb-2 mb-4">Mekanisme Pelaksanaan</h3>
                    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-6 rounded-lg" role="alert">
                        <p class="font-bold mb-2">Bagaimana jika ada siswa yang terbukti melakukan pelanggaran?</p>
                        <p>Maka petugas wajib memerintahkan siswa yang bersangkutan untuk mengisi dan menandatangani blangko pelanggaran siswa.</p>
                    </div>
                </section>

                <section class="mb-8">
                    <h3 class="text-2xl font-bold text-gray-800 border-b-2 border-blue-200 pb-2 mb-4">Tindak Lanjut</h3>
                    <ol class="list-alpha list-inside space-y-3 text-gray-700">
                        <li>Data dari setiap siswa akan direkap oleh petugas ketertiban setiap 2 minggu, kemudian dilaporkan kepada guru BK, kemudian data tersebut dilaporkan kepada wali kelas dan wakil kepala sekolah.</li>
                        <li>Selanjutnya pemberian tindakan/sanksi sesuai dengan jenis dan jumlah poin pelanggaran.</li>
                    </ol>
                </section>

                <footer class="text-center text-gray-500 italic mt-12 pt-6 border-t">
                    <p>"SAYA SIAP MENJADI SISWA SISWI YANG BERAKHLAQ, BERPERILAKU BAIK, BERKUALITAS DAN MELAKSANAKAN ATURAN SEKOLAH DENGAN BAIK."</p>
                </footer>

            </div>
        </div>
        <div id="successMessage" class="hidden fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
            <div class="flex items-center space-x-2">
                <span>‚úÖ</span>
                <span id="successText">Poin berhasil ditambahkan!</span>
            </div>
        </div>
    </div>

    <script>
        // --- STRUKTUR DATA (TETAP SAMA) ---
        const createStudent = (className) => ({
            // ... (Fungsi createStudent tetap sama)
            class: className,
            points: 0,
            violations: {
                'Terlambat': 0,
                'Tidak Mengerjakan PR': 0,
                'Tidak Berseragam': 0,
                'Mengganggu Kelas': 0,
                'Merokok': 0,
                'Berkelahi': 0
            }
        });

        let studentData = {
            // ... (Data siswa lengkap tetap sama)
            'ANGGI ARLIJANTI': createStudent('XI 1'),
            'ARDHONI UBAIDILLAH RIZKY': createStudent('XI 1'),
            'AYU WULANDARI': createStudent('XI 1'),
            'BILQIS AMIROH AZZAH ARIDAH': createStudent('XI 1'),
            'DEVINA ARDIANTI RAMADHANI': createStudent('XI 1'),
            'ELINDA NOVITA': createStudent('XI 1'),
            'KHOIROTUN NISA`': createStudent('XI 1'),
            'KRISNANDA ANGGA SAPUTRA': createStudent('XI 1'),
            'LAILATUL MAULIDA NAJA ZHICA': createStudent('XI 1'),
            'M. DIMAS ARIF SAIFULLAH': createStudent('XI 1'),
            'M. DITO FAHRUDIN': createStudent('XI 1'),
            'MAULUDIN DHOFA ERWIN SYAH': createStudent('XI 1'),
            'MUHAMMAD AFIFFUDIN': createStudent('XI 1'),
            'MUHAMMAD AZWAR ANAS NASRUDIN ': createStudent('XI 1'),
            'MUHAMMAD MUFLIH HASAN ANSHORI': createStudent('XI 1'),
            'MUNIFAH SANIA ANJANI': createStudent('XI 1'),
            'RINA OCTAVIANA': createStudent('XI 1'),
            'SAIFUN NISA`': createStudent('XI 1'),
            'SIRIN EL-MASSHOBAH': createStudent('XI 1'),
            'ZAHRA RAHMA PUTRI': createStudent('XI 1'),
            'AE VITRA SEPTA RAMADHAN': createStudent('XI 2'),
            'AHMAD AZUMAR DIAZRA': createStudent('XI 2'),
            'ANINDYA PUTRI SALSABILA': createStudent('XI 2'),
            'ATHI\'NAJIYAN ROBBANI': createStudent('XI 2'),
            'ATQOL MUSIBIIN': createStudent('XI 2'),
            'AULIA AZZAHRO': createStudent('XI 2'),
            'DEVIN ISCA PUZAMIL': createStudent('XI 2'),
            'DINA AYU KURNIA': createStudent('XI 2'),
            'DURROTUL LAILI': createStudent('XI 2'),
            'FIVA LAILATUN NISFIYAH': createStudent('XI 2'),
            'HAIKAL ZIYAD AHMAD': createStudent('XI 2'),
            'HUSNAH RAMADANI': createStudent('XI 2'),
            'MAULUDIN DHOFA IRWAN SYAH': createStudent('XI 2'),
            'MUHAMMAD RADIT ALDIANSYAH': createStudent('XI 2'),
            'MUHAMMAD ROFIK': createStudent('XI 2'),
            'MUTIA SYAFITRI ROZI': createStudent('XI 2'),
            'NADHIFAH AULIYA PUTRI': createStudent('XI 2'),
            'NUR MAKAYLA RAHMADANI': createStudent('XI 2'),
            'NUUHATUN NABIILAH MABRUKHAH': createStudent('XI 2'),
            'RATRI PRAMUDITA': createStudent('XI 2'),
            'ROHMAH DWI SANGGARWATI': createStudent('XI 2'),
            'SITI UMIYATUS SHOLEHAH': createStudent('XI 2'),
            'ULFI DWI TAKWATI': createStudent('XI 2'),
            'UMMI ZAIDHAH': createStudent('XI 2'),
            'ZAENATUL MAR\'AH NOVIANTI': createStudent('XI 2'),
            'ZAKIYYAH YUNI MAULIDAH': createStudent('XI 2'),
            'AHMAD PRAWIRO EDY': createStudent('X 1'),
            'AMELIA SEPTIA RAMADHANI': createStudent('X 1'),
            'ASRORI WALUYO': createStudent('X 1'),
            'BILQIS MALAKATUS SABA': createStudent('X 1'),
            'BRYLLIAN SENATRYA AKBAR': createStudent('X 1'),
            'DEVVAN LEONEL SYAIFUDDIN': createStudent('X 1'),
            'DITA AINUR RAMADHANI': createStudent('X 1'),
            'FATIMATUZZAHRO': createStudent('X 1'),
            'ISNA WARDA KHOIRIYAH': createStudent('X 1'),
            'M. NAILUL AUTHOR': createStudent('X 1'),
            'MUHAMMAD FAIQ ABDURROHMAN': createStudent('X 1'),
            'MUHAMMAD FIKRI MUBAROQ PUTRA': createStudent('X 1'),
            'M. KHOIRUL HADI': createStudent('X 1'),
            'MUHAMMAD ROMADHON MUBAROK': createStudent('X 1'),
            'NADHIFATUL LUTFIAH': createStudent('X 1'),
            'NADIA LUTHFIATUS SHOLIHAH': createStudent('X 1'),
            'NAJIYA KEISYA RAMADHANI': createStudent('X 1'),
            'NAJWA ZAHROTUL MUNA WIJAYA': createStudent('X 1'),
            'NAVELIA ALTHAFUNNISA\' AL CHUSAIN': createStudent('X 1'),
            'RIFDAH HANA ROCHMAH': createStudent('X 1'),
            'RIZKINA LAILA FITRI': createStudent('X 1'),
            'SAFIRA DARMAYANTI EKA OKTAFIANI': createStudent('X 1'),
            'SEFYA PUTRI RAMADHANI': createStudent('X 1'),
            'MUHAMMAD AZIZ FIRMANSYAH': createStudent('X 1'),
            'ABD KOLIQ AL KIROM': createStudent('X 2'),
            'ABDULLAH ANAS': createStudent('X 2'),
            'AH. SIKHU ASRORI': createStudent('X 2'),
            'AHMAD MARVEL EARL VANCOUVER': createStudent('X 2'),
            'AIS FARIKHATUL QUDSIYYAH': createStudent('X 2'),
            'ASRIFATIN NIKMAH': createStudent('X 2'),
            'AVRILLA ANANTA SISILIA': createStudent('X 2'),
            'CATUR SETYO UTOMO': createStudent('X 2'),
            'HASNA IRAWATI': createStudent('X 2'),
            'HENI NUR HIDAYAH': createStudent('X 2'),
            'ISNAINI SHOFIYAH DZAKIROH': createStudent('X 2'),
            'KUMALA SARI': createStudent('X 2'),
            'LUNAILAH FITRIYANA': createStudent('X 2'),
            'M. ADAMIL AZFAR SAFWATULLAH': createStudent('X 2'),
            'M. ILZAMY PUTRA P': createStudent('X 2'),
            'M. VIRGA AUFAA ILHAMI': createStudent('X 2'),
            'MEGA INDAH WULANDARI': createStudent('X 2'),
            'MOH. MIFTAHUL BADAR': createStudent('X 2'),
            'MUHAMAD RIDHO AULIA ALIF ALAMSYAH': createStudent('X 2'),
            'MUHAMMAD ALFARISI SUTRISNO': createStudent('X 2'),
            'NOVITA SAFIRA PUTRI': createStudent('X 2'),
            'PUTRI AMIROTUL LATHIFAH': createStudent('X 2'),
            'RIKA AODYA FATMAWATI': createStudent('X 2'),
            'RIRIS NUR AULIA AZZAHRAH': createStudent('X 2'),
            'HIFZIN YASID AL SYA\'BANI': createStudent('X 2'),
            'AHMAD ALFARIFQY EL FATIH': createStudent('XII 1'),
            'AHMAD FAISAL ADI SAPUTRA': createStudent('XII 1'),
            'AHMAD KHARIM MUTATOHHIRIN': createStudent('XII 1'),
            'AJENG AYU SORAYA': createStudent('XII 1'),
            'AZKA NAURA': createStudent('XII 1'),
            'CHOIROTUN NI\'MAH': createStudent('XII 1'),
            'DIAN LAILATUL SAZKIA': createStudent('XII 1'),
            'DWI AMELIA ARYANI': createStudent('XII 1'),
            'ELVITA DWI RAHMA': createStudent('XII 1'),
            'FADHEA MIFTACH RIZKY ALIS TI\'ANAH': createStudent('XII 1'),
            'IQBAL ALIMUL FUAD': createStudent('XII 1'),
            'KHOIRUN NISA FEBRIANTI VALENTINA': createStudent('XII 1'),
            'KHOIRUNNISA\'': createStudent('XII 1'),
            'KHOLIFATUL LAILIYAH': createStudent('XII 1'),
            'KHOLILATUR ROHMANIYAH': createStudent('XII 1'),
            'LATIFATUL KHOFIFAH': createStudent('XII 1'),
            'MAULANA ZUHAD FATHURROHMAN': createStudent('XII 1'),
            'MOH. DIMAS FIRMANSYAH': createStudent('XII 1'),
            'MUHAMMAD NUZUL FADIL': createStudent('XII 1'),
            'NADIRA AFLAHAH ZAAHIROH': createStudent('XII 1'),
            'NAFIDATUS SAHIDA': createStudent('XII 1'),
            'NANDA AULIA MADJID': createStudent('XII 1'),
            'NAZIIHAH ROONA MARELLA': createStudent('XII 1'),
            'NUR FADLILAH': createStudent('XII 1'),
            'NUR SYAHRANI MAGHFIROH RAMADHANI': createStudent('XII 1'),
            'RISFANDI TRI ARDIANSYAH': createStudent('XII 1'),
            'RIZKY PUTRI AMEILIA DEWI': createStudent('XII 1'),
            'SITI ABIDAH ARDELia': createStudent('XII 1'),
            'SITI ROIHATUS SHOLIHA': createStudent('XII 1'),
            'SYARIFAH ZAHARA': createStudent('XII 1'),
            'ZAHROTUL JANNAH': createStudent('XII 1'),
            'ZAURA ZAHARANI AULIA BILQIS': createStudent('XII 1'),
            'MOHAMMAD FADLIL AKBAR': createStudent('XII 1'),
            'ABDULLAH HAMID AL-BASYARI': createStudent('XII 2'),
            'ADELLIA PUTRI RAMADHANI': createStudent('XII 2'),
            'AGNIYATUL MUTMA\'INNAH': createStudent('XII 2'),
            'AHMAD ZUSRIL DHINI ZAB': createStudent('XII 2'),
            'ALFIYYAH FEBRIANTI': createStudent('XII 2'),
            'AMIRA KHAIRUNNISA': createStudent('XII 2'),
            'AZZA WIRDANINGSIH': createStudent('XII 2'),
            'DEVINA AMELIA PUTRI': createStudent('XII 2'),
            'DINI NABILATUL AULIA': createStudent('XII 2'),
            'ENGGA AL MA\'ARIF': createStudent('XII 2'),
            'HILMY ABDULLAH NUR HAQIQI': createStudent('XII 2'),
            'MAYLA ALTHAFUNNISA\' AL CHUSAIN': createStudent('XII 2'),
            'MIFTAQUL AFSIYAH': createStudent('XII 2'),
            'MOH. KHOBDOTIR JABBAR': createStudent('XII 2'),
            'MOH. RIEF\'AN KHOIRON ROSICKY': createStudent('XII 2'),
            'MOH. RIZKI AGUS SAPUTRA': createStudent('XII 2'),
            'MUHAMMAD ALAWI': createStudent('XII 2'),
            'MUHAMMAD ALI HAIDAR RAMADLAN': createStudent('XII 2'),
            'MUHAMMAD DAFA AFRIYANTO': createStudent('XII 2'),
            'MUHAMMAD ZAKY MAULANA AQIL': createStudent('XII 2'),
            'NOVA AMELIA': createStudent('XII 2'),
            'QINARA SABILAL MILLAH': createStudent('XII 2'),
            'RIZKY INDRAWAN MAULANA': createStudent('XII 2'),
            'SITI NUR ASIYAH': createStudent('XII 2'),
            'TRI ALIF AKHMAD AFIANTO': createStudent('XII 2'),
            'WILDANIA HIKMATUL FARIKHA': createStudent('XII 2'),
            'ZULIYANA KHOIR': createStudent('XII 2'),
            'BILLQIES BAJROYEKTI MP.': createStudent('XII 2')
        };


        // Valid teacher codes
        const teacherCodes = ['SMANJAOKE123'];

        // --- BARU: FUNGSI showTab DIPERBARUI ---
        function showTab(tab) {
            // Hide all sections
            document.getElementById('publicSection').classList.add('hidden');
            document.getElementById('teacherSection').classList.add('hidden');
            document.getElementById('recapSection').classList.add('hidden');
            document.getElementById('rulesSection').classList.add('hidden'); // <-- BARU

            // Remove active class from all tabs
            document.getElementById('publicTab').classList.remove('bg-indigo-500', 'text-white');
            document.getElementById('teacherTab').classList.remove('bg-indigo-500', 'text-white');
            document.getElementById('recapTab').classList.remove('bg-indigo-500', 'text-white');
            document.getElementById('rulesTab').classList.remove('bg-indigo-500', 'text-white'); // <-- BARU
            
            document.getElementById('publicTab').classList.add('text-gray-600');
            document.getElementById('teacherTab').classList.add('text-gray-600');
            document.getElementById('recapTab').classList.add('text-gray-600');
            document.getElementById('rulesTab').classList.add('text-gray-600'); // <-- BARU

            // Show selected section and activate tab
            if (tab === 'public') {
                document.getElementById('publicSection').classList.remove('hidden');
                document.getElementById('publicTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('publicTab').classList.remove('text-gray-600');
            } else if (tab === 'teacher') {
                document.getElementById('teacherSection').classList.remove('hidden');
                document.getElementById('teacherTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('teacherTab').classList.remove('text-gray-600');
            } else if (tab === 'recap') {
                document.getElementById('recapSection').classList.remove('hidden');
                document.getElementById('recapTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('recapTab').classList.remove('text-gray-600');
                updateRecap();
            } else if (tab === 'rules') { // <-- BLOK KONDISI BARU
                document.getElementById('rulesSection').classList.remove('hidden');
                document.getElementById('rulesTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('rulesTab').classList.remove('text-gray-600');
            }
        }

        function verifyTeacher() {
            // ... (Fungsi verifyTeacher tetap sama)
             const code = document.getElementById('teacherCode').value;
            if (teacherCodes.includes(code)) {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('teacherPanel').classList.remove('hidden');
            } else {
                alert('‚ùå Kode akses tidak valid! (Demo: SMANJAOKE123)');
            }
        }

        function logout() {
            // ... (Fungsi logout tetap sama)
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('teacherPanel').classList.add('hidden');
            document.getElementById('teacherCode').value = '';
        }

        function addViolation(violationType, points) {
            // ... (Fungsi addViolation tetap sama)
            const selectedStudent = document.getElementById('studentSelect').value;
            if (!selectedStudent) {
                alert('‚ö†Ô∏è Silakan pilih siswa terlebih dahulu!');
                return;
            }
            studentData[selectedStudent].points += points;
            studentData[selectedStudent].violations[violationType]++;
            renderStudentTable(); 
            updateRecap();
            showSuccessMessage(`Poin ${violationType} (+${points}) berhasil ditambahkan untuk ${selectedStudent}`);
        }

        function renderStudentTable() {
            // ... (Fungsi renderStudentTable tetap sama)
            const filter = document.getElementById('searchInput').value.toUpperCase();
            const tableBody = document.getElementById('studentTable');
            tableBody.innerHTML = '';
            const groupedStudents = {};
            Object.keys(studentData).forEach(name => {
                const student = studentData[name];
                if (!groupedStudents[student.class]) {
                    groupedStudents[student.class] = [];
                }
                groupedStudents[student.class].push({ name, ...student });
            });
            const classOrder = {'X': 1, 'XI': 2, 'XII': 3};
            const sortedClasses = Object.keys(groupedStudents).sort((a, b) => {
                const [prefixA] = a.split(' ');
                const [prefixB] = b.split(' ');
                const orderA = classOrder[prefixA] || 99;
                const orderB = classOrder[prefixB] || 99;
                if (orderA !== orderB) {
                    return orderA - orderB;
                }
                return a.localeCompare(b);
            });
            sortedClasses.forEach(className => {
                const classHeaderRow = document.createElement('tr');
                classHeaderRow.classList.add('bg-indigo-100', 'font-bold');
                classHeaderRow.innerHTML = `
                    <td colspan="4" class="border border-gray-300 px-4 py-3 text-indigo-900">${className}</td>
                `;
                tableBody.appendChild(classHeaderRow);
                const studentsInClass = groupedStudents[className].sort((a, b) => a.name.localeCompare(b.name));
                let studentsFound = 0;
                studentsInClass.forEach(student => {
                    if (student.name.toUpperCase().indexOf(filter) > -1) {
                        studentsFound++;
                        const row = document.createElement('tr');
                        let status, statusClass;
                        if (student.points <= 10) {
                            status = 'Baik';
                            statusClass = 'bg-green-100 text-green-800';
                        } else if (student.points <= 20) {
                            status = 'Peringatan';
                            statusClass = 'bg-yellow-100 text-yellow-800';
                        } else {
                            status = 'Bermasalah';
                            statusClass = 'bg-red-100 text-red-800';
                        }
                        let pointsColor;
                        if (student.points <= 10) pointsColor = 'text-green-600';
                        else if (student.points <= 20) pointsColor = 'text-orange-600';
                        else pointsColor = 'text-red-600';
                        row.innerHTML = `
                            <td class="border border-gray-300 px-4 py-3">${student.name}</td>
                            <td class="border border-gray-300 px-4 py-3">${student.class}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center font-bold ${pointsColor}">${student.points}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center">
                                <span class="${statusClass} px-2 py-1 rounded-full text-sm">${status}</span>
                            </td>
                        `;
                        tableBody.appendChild(row);
                    }
                });
                if (studentsFound === 0 && filter.length > 0) {
                    classHeaderRow.classList.add('hidden');
                }
            });
        }
        
        function populateStudentSelect() {
            // ... (Fungsi populateStudentSelect tetap sama)
            const select = document.getElementById('studentSelect');
            select.innerHTML = '<option value="">-- Pilih Siswa --</option>';
            const sortedNames = Object.keys(studentData).sort();
            sortedNames.forEach(name => {
                const student = studentData[name];
                const option = document.createElement('option');
                option.value = name;
                option.textContent = `${name} - ${student.class}`;
                select.appendChild(option);
            });
        }

        function showSuccessMessage(message) {
            // ... (Fungsi showSuccessMessage tetap sama)
            const successMessage = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            successText.textContent = message;
            successMessage.classList.remove('hidden');
            successMessage.classList.add('pulse-animation');
            setTimeout(() => {
                successMessage.classList.add('hidden');
                successMessage.classList.remove('pulse-animation');
            }, 3000);
        }

        function updateRecap() {
            // ... (Fungsi updateRecap tetap sama)
            const detailTableBody = document.getElementById('recapDetailTableBody');
            detailTableBody.innerHTML = '';
            const sortedNames = Object.keys(studentData).sort();
            sortedNames.forEach(name => {
                const student = studentData[name];
                let status, statusClass;
                if (student.points <= 10) {
                    status = 'Baik';
                    statusClass = 'bg-green-100 text-green-800';
                } else if (student.points <= 20) {
                    status = 'Peringatan';
                    statusClass = 'bg-yellow-100 text-yellow-800';
                } else {
                    status = 'Bermasalah';
                    statusClass = 'bg-red-100 text-red-800';
                }
                let pointsColor;
                if (student.points <= 10) pointsColor = 'text-green-600';
                else if (student.points <= 20) pointsColor = 'text-orange-600';
                else pointsColor = 'text-red-600';
                let violationString = Object.keys(student.violations)
                    .filter(type => student.violations[type] > 0)
                    .map(type => `${type} (x${student.violations[type]})`)
                    .join(', ');
                if (student.points === 0) {
                    violationString = "Tidak ada pelanggaran";
                }
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 px-4 py-3">${name}</td>
                    <td class="border border-gray-300 px-4 py-3">${student.class}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center font-bold ${pointsColor}">${student.points}</td>
                    <td class="border border-gray-300 px-4 py-3 text-center">
                        <span class="${statusClass} px-2 py-1 rounded-full text-sm">${status}</span>
                    </td>
                    <td class="border border-gray-300 px-4 py-3">${violationString}</td>
                `;
                detailTableBody.appendChild(row);
            });
        }
        
        function downloadRecapAsExcel() {
            // ... (Fungsi downloadRecapAsExcel tetap sama)
            const tableHTML = document.querySelector("#recapDetailContent table").outerHTML;
            const htmlTemplate = `
                <!DOCTYPE html>
                <html lang="id">
                <head>
                    <meta charset="UTF-8">
                    <title>Rekap Detail Kedisiplinan</title>
                    <style>
                        body { font-family: Arial, sans-serif; }
                        table { border-collapse: collapse; width: 100%; font-size: 10pt; }
                        th, td { border: 1px solid #666; padding: 8px; text-align: left; }
                        th { background-color: #f0f0f0; font-weight: bold; }
                        .bg-gray-50 { background-color: #f9fafb; }
                        .bg-green-100 { background-color: #d1fae5; }
                        .text-green-800 { color: #065f46; }
                        .bg-yellow-100 { background-color: #fef3c7; }
                        .text-yellow-800 { color: #92400e; }
                        .bg-red-100 { background-color: #fee2e2; }
                        .text-red-800 { color: #991b1b; }
                        .text-green-600 { color: #059669; }
                        .text-orange-600 { color: #ea580c; }
                        .text-red-600 { color: #dc2626; }
                        .font-bold { font-weight: bold; }
                        .text-center { text-align: center; }
                        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
                        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
                        .rounded-full { border-radius: 9999px; }
                        .text-sm { font-size: 0.875rem; }
                    </style>
                </head>
                <body>
                    <h2>Rekap Detail Seluruh Siswa</h2>
                    <p>Data pelanggaran siswa yang diekspor pada ${new Date().toLocaleString('id-ID')}</p>
                    ${tableHTML}
                </body>
                </html>
            `;
            const blob = new Blob([htmlTemplate], { type: 'application/vnd.ms-excel' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "rekap_detail_kedisiplinan.xls";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderStudentTable();
            populateStudentSelect();
            updateRecap();
        });
    </script>
</body>
</html>
