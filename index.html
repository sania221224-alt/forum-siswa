<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forum Kedisiplinan Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-full">
    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-indigo-800 mb-2">📋 Forum Kedisiplinan</h1>
            <p class="text-gray-600">Sistem Monitoring Pelanggaran Siswa</p>
        </div>

        <div class="flex justify-center mb-8">
            <div class="bg-white rounded-lg shadow-md p-1 flex">
                <button onclick="showTab('public')" id="publicTab" class="px-6 py-2 rounded-md font-medium transition-all bg-indigo-500 text-white">
                    👥 Data Publik
                </button>
                <button onclick="showTab('teacher')" id="teacherTab" class="px-6 py-2 rounded-md font-medium transition-all text-gray-600 hover:text-indigo-600">
                    👨‍🏫 Akses Guru
                </button>
                <button onclick="showTab('recap')" id="recapTab" class="px-6 py-2 rounded-md font-medium transition-all text-gray-600 hover:text-indigo-600">
                    📊 Rekap
                </button>
            </div>
        </div>

        <div id="publicSection" class="fade-in">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">📊 Data Poin Pelanggaran Siswa</h2>
                
                <div class="mb-4">
                    <input type="text" id="searchInput" onkeyup="renderStudentTable()" 
                           placeholder="Ketuk untuk mencari nama siswa..." 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-indigo-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-indigo-800">Nama Siswa</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold text-indigo-800">Kelas</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-indigo-800">Total Poin</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold text-indigo-800">Status</th>
                            </tr>
                        </thead>
                        <tbody id="studentTable">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">📋 Kategori Status</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="flex items-center space-x-2">
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Baik</span>
                        <span class="text-gray-600">0-10 poin</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">Peringatan</span>
                        <span class="text-gray-600">11-20 poin</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm font-medium">Bermasalah</span>
                        <span class="text-gray-600">21+ poin</span> </div>
                </div>
            </div>
        </div>

        <div id="teacherSection" class="hidden">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">🔐 Akses Guru</h2>
                
                <div id="loginForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kode Akses Guru</label>
                        <input type="password" id="teacherCode" placeholder="Masukkan kode akses" 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button onclick="verifyTeacher()" class="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-indigo-700 transition-colors">
                        🔓 Masuk
                    </button>
                </div>

                <div id="teacherPanel" class="hidden space-y-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <p class="text-green-800 font-medium">✅ Berhasil masuk sebagai guru</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Siswa</label>
                        <select id="studentSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500">
                            <option value="">-- Pilih Siswa --</option>
                            </select>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-gray-800 mb-4">Jenis Pelanggaran</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button onclick="addViolation('Terlambat', 2)" class="bg-yellow-100 hover:bg-yellow-200 border-2 border-yellow-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-yellow-800">⏰ Terlambat</div>
                                <div class="text-sm text-yellow-600">+2 poin</div>
                            </button>
                            <button onclick="addViolation('Tidak Mengerjakan PR', 3)" class="bg-orange-100 hover:bg-orange-200 border-2 border-orange-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-orange-800">📚 Tidak Mengerjakan PR</div>
                                <div class="text-sm text-orange-600">+3 poin</div>
                            </button>
                            <button onclick="addViolation('Tidak Berseragam', 5)" class="bg-red-100 hover:bg-red-200 border-2 border-red-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-red-800">👔 Tidak Berseragam</div>
                                <div class="text-sm text-red-600">+5 poin</div>
                            </button>
                            <button onclick="addViolation('Mengganggu Kelas', 4)" class="bg-purple-100 hover:bg-purple-200 border-2 border-purple-300 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-purple-800">🗣️ Mengganggu Kelas</div>
                                <div class="text-sm text-purple-600">+4 poin</div>
                            </button>
                            <button onclick="addViolation('Merokok', 10)" class="bg-red-200 hover:bg-red-300 border-2 border-red-400 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-red-900">🚭 Merokok</div>
                                <div class="text-sm text-red-700">+10 poin</div>
                            </button>
                            <button onclick="addViolation('Berkelahi', 15)" class="bg-red-300 hover:bg-red-400 border-2 border-red-500 rounded-lg p-4 text-left transition-all">
                                <div class="font-bold text-red-900">👊 Berkelahi</div>
                                <div class="text-sm text-red-800">+15 poin</div>
                            </button>
                        </div>
                    </div>

                    <button onclick="logout()" class="w-full bg-gray-500 text-white py-3 px-6 rounded-lg font-medium hover:bg-gray-600 transition-colors">
                        🚪 Keluar
                    </button>
                </div>
            </div>
        </div>

        <div id="recapSection" class="hidden">
            <div id="recapContent" class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">📊 Rekap Ringkasan Mingguan</h2>
                
                <div class="mb-6">
                    <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-4">
                        <h3 class="font-bold text-indigo-800 mb-2">📅 Periode: 27 Okt - 2 Nov 2025</h3>
                        <p class="text-indigo-600">Data diperbarui secara real-time</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                        <div id="recapBaik" class="text-3xl font-bold text-green-600">0</div>
                        <div class="text-green-800 font-medium">Siswa Baik</div>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                        <div id="recapPeringatan" class="text-3xl font-bold text-yellow-600">0</div>
                        <div class="text-yellow-800 font-medium">Siswa Peringatan</div>
                    </div>
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 text-center">
                        <div id="recapBermasalah" class="text-3xl font-bold text-red-600">0</div>
                        <div class="text-red-800 font-medium">Siswa Bermasalah</div>
                    </div>
                </div>

                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Jenis Pelanggaran</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold">Jumlah Kasus</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold">Total Poin</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3">⏰ Terlambat</td>
                                <td id="recapTerlambatJumlah" class="border border-gray-300 px-4 py-3 text-center">0</td>
                                <td id="recapTerlambatPoin" class="border border-gray-300 px-4 py-3 text-center font-bold">0</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3">📚 Tidak Mengerjakan PR</td>
                                <td id="recapPRJumlah" class="border border-gray-300 px-4 py-3 text-center">0</td>
                                <td id="recapPRPoin" class="border border-gray-300 px-4 py-3 text-center font-bold">0</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3">👔 Tidak Berseragam</td>
                                <td id="recapSeragamJumlah" class="border border-gray-300 px-4 py-3 text-center">0</td>
                                <td id="recapSeragamPoin" class="border border-gray-300 px-4 py-3 text-center font-bold">0</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3">🗣️ Mengganggu Kelas</td>
                                <td id="recapMenggangguJumlah" class="border border-gray-300 px-4 py-3 text-center">0</td>
                                <td id="recapMenggangguPoin" class="border border-gray-300 px-4 py-3 text-center font-bold">0</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3">🚭 Merokok</td>
                                <td id="recapMerokokJumlah" class="border border-gray-300 px-4 py-3 text-center">0</td>
                                <td id="recapMerokokPoin" class="border border-gray-300 px-4 py-3 text-center font-bold">0</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3">👊 Berkelahi</td>
                                <td id="recapBerkelahiJumlah" class="border border-gray-300 px-4 py-3 text-center">0</td>
                                <td id="recapBerkelahiPoin" class="border border-gray-300 px-4 py-3 text-center font-bold">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button onclick="downloadRecap()" class="mt-6 w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-700 transition-colors">
                    📥 Unduh Ringkasan (.doc)
                </button>
            </div>
            
            <div id="recapDetailContent" class="bg-white rounded-xl shadow-lg p-6 mt-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">🔍 Detail Pelanggaran per Siswa</h2>
                <p class="text-gray-600 mb-4">Hanya siswa dengan poin pelanggaran yang akan ditampilkan di sini.</p>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Nama Siswa</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Kelas</th>
                                <th class="border border-gray-300 px-4 py-3 text-left font-semibold">Detail Pelanggaran</th>
                                <th class="border border-gray-300 px-4 py-3 text-center font-semibold">Total Poin</th>
                            </tr>
                        </thead>
                        <tbody id="recapDetailTableBody">
                            </tbody>
                    </table>
                </div>
            </div>

            <button onclick="downloadDetailRecapAsCSV()" class="mt-6 w-full bg-green-600 text-white py-3 px-6 rounded-lg font-medium hover:bg-green-700 transition-colors">
                📥 Unduh Detail (Excel/CSV)
            </button>
        </div>
        <div id="successMessage" class="hidden fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50">
            <div class="flex items-center space-x-2">
                <span>✅</span>
                <span id="successText">Poin berhasil ditambahkan!</span>
            </div>
        </div>
    </div>

    <script>
        // --- BARU: MODIFIKASI STRUKTUR DATA ---
        // Menambahkan properti 'violations' untuk melacak setiap jenis pelanggaran
        const createStudent = (className) => ({
            class: className,
            points: 0,
            violations: {
                'Terlambat': 0,
                'Tidak Mengerjakan PR': 0,
                'Tidak Berseragam': 0,
                'Mengganggu Kelas': 0,
                'Merokok': 0,
                'Berkelahi': 0
            }
        });

        let studentData = {
            // Data from tableConvert.com_l8a37z.html (XI 1)
            'ANGGI ARLIJANTI': createStudent('XI 1'),
            'ARDHONI UBAIDILLAH RIZKY': createStudent('XI 1'),
            'AYU WULANDARI': createStudent('XI 1'),
            'BILQIS AMIROH AZZAH ARIDAH': createStudent('XI 1'),
            'DEVINA ARDIANTI RAMADHANI': createStudent('XI 1'),
            'ELINDA NOVITA': createStudent('XI 1'),
            'KHOIROTUN NISA`': createStudent('XI 1'),
            'KRISNANDA ANGGA SAPUTRA': createStudent('XI 1'),
            'LAILATUL MAULIDA NAJA ZHICA': createStudent('XI 1'),
            'M. DIMAS ARIF SAIFULLAH': createStudent('XI 1'),
            'M. DITO FAHRUDIN': createStudent('XI 1'),
            'MAULUDIN DHOFA ERWIN SYAH': createStudent('XI 1'),
            'MUHAMMAD AFIFFUDIN': createStudent('XI 1'),
            'MUHAMMAD AZWAR ANAS NASRUDIN ': createStudent('XI 1'),
            'MUHAMMAD MUFLIH HASAN ANSHORI': createStudent('XI 1'),
            'MUNIFAH SANIA ANJANI': createStudent('XI 1'),
            'RINA OCTAVIANA': createStudent('XI 1'),
            'SAIFUN NISA`': createStudent('XI 1'),
            'SIRIN EL-MASSHOBAH': createStudent('XI 1'),
            'ZAHRA RAHMA PUTRI': createStudent('XI 1'),
            
            // Data from tableConvert.com_yurjv8.html (XI 2)
            'AE VITRA SEPTA RAMADHAN': createStudent('XI 2'),
            'AHMAD AZUMAR DIAZRA': createStudent('XI 2'),
            'ANINDYA PUTRI SALSABILA': createStudent('XI 2'),
            'ATHI\'NAJIYAN ROBBANI': createStudent('XI 2'),
            'ATQOL MUSIBIIN': createStudent('XI 2'),
            'AULIA AZZAHRO': createStudent('XI 2'),
            'DEVIN ISCA PUZAMIL': createStudent('XI 2'),
            'DINA AYU KURNIA': createStudent('XI 2'),
            'DURROTUL LAILI': createStudent('XI 2'),
            'FIVA LAILATUN NISFIYAH': createStudent('XI 2'),
            'HAIKAL ZIYAD AHMAD': createStudent('XI 2'),
            'HUSNAH RAMADANI': createStudent('XI 2'),
            'MAULUDIN DHOFA IRWAN SYAH': createStudent('XI 2'),
            'MUHAMMAD RADIT ALDIANSYAH': createStudent('XI 2'),
            'MUHAMMAD ROFIK': createStudent('XI 2'),
            'MUTIA SYAFITRI ROZI': createStudent('XI 2'),
            'NADHIFAH AULIYA PUTRI': createStudent('XI 2'),
            'NUR MAKAYLA RAHMADANI': createStudent('XI 2'),
            'NUUHATUN NABIILAH MABRUKHAH': createStudent('XI 2'),
            'RATRI PRAMUDITA': createStudent('XI 2'),
            'ROHMAH DWI SANGGARWATI': createStudent('XI 2'),
            'SITI UMIYATUS SHOLEHAH': createStudent('XI 2'),
            'ULFI DWI TAKWATI': createStudent('XI 2'),
            'UMMI ZAIDHAH': createStudent('XI 2'),
            'ZAENATUL MAR\'AH NOVIANTI': createStudent('XI 2'),
            'ZAKIYYAH YUNI MAULIDAH': createStudent('XI 2'),
            
            // Data from tableConvert.com_tg2qs1.html (X 1)
            'AHMAD PRAWIRO EDY': createStudent('X 1'),
            'AMELIA SEPTIA RAMADHANI': createStudent('X 1'),
            'ASRORI WALUYO': createStudent('X 1'),
            'BILQIS MALAKATUS SABA': createStudent('X 1'),
            'BRYLLIAN SENATRYA AKBAR': createStudent('X 1'),
            'DEVVAN LEONEL SYAIFUDDIN': createStudent('X 1'),
            'DITA AINUR RAMADHANI': createStudent('X 1'),
            'FATIMATUZZAHRO': createStudent('X 1'),
            'ISNA WARDA KHOIRIYAH': createStudent('X 1'),
            'M. NAILUL AUTHOR': createStudent('X 1'),
            'MUHAMMAD FAIQ ABDURROHMAN': createStudent('X 1'),
            'MUHAMMAD FIKRI MUBAROQ PUTRA': createStudent('X 1'),
            'M. KHOIRUL HADI': createStudent('X 1'),
            'MUHAMMAD ROMADHON MUBAROK': createStudent('X 1'),
            'NADHIFATUL LUTFIAH': createStudent('X 1'),
            'NADIA LUTHFIATUS SHOLIHAH': createStudent('X 1'),
            'NAJIYA KEISYA RAMADHANI': createStudent('X 1'),
            'NAJWA ZAHROTUL MUNA WIJAYA': createStudent('X 1'),
            'NAVELIA ALTHAFUNNISA\' AL CHUSAIN': createStudent('X 1'),
            'RIFDAH HANA ROCHMAH': createStudent('X 1'),
            'RIZKINA LAILA FITRI': createStudent('X 1'),
            'SAFIRA DARMAYANTI EKA OKTAFIANI': createStudent('X 1'),
            'SEFYA PUTRI RAMADHANI': createStudent('X 1'),
            'MUHAMMAD AZIZ FIRMANSYAH': createStudent('X 1'),
            
            // Data from tableConvert.com_omp34l.html (X 2)
            'ABD KOLIQ AL KIROM': createStudent('X 2'),
            'ABDULLAH ANAS': createStudent('X 2'),
            'AH. SIKHU ASRORI': createStudent('X 2'),
            'AHMAD MARVEL EARL VANCOUVER': createStudent('X 2'),
            'AIS FARIKHATUL QUDSIYYAH': createStudent('X 2'),
            'ASRIFATIN NIKMAH': createStudent('X 2'),
            'AVRILLA ANANTA SISILIA': createStudent('X 2'),
            'CATUR SETYO UTOMO': createStudent('X 2'),
            'HASNA IRAWATI': createStudent('X 2'),
            'HENI NUR HIDAYAH': createStudent('X 2'),
            'ISNAINI SHOFIYAH DZAKIROH': createStudent('X 2'),
            'KUMALA SARI': createStudent('X 2'),
            'LUNAILAH FITRIYANA': createStudent('X 2'),
            'M. ADAMIL AZFAR SAFWATULLAH': createStudent('X 2'),
            'M. ILZAMY PUTRA P': createStudent('X 2'),
            'M. VIRGA AUFAA ILHAMI': createStudent('X 2'),
            'MEGA INDAH WULANDARI': createStudent('X 2'),
            'MOH. MIFTAHUL BADAR': createStudent('X 2'),
            'MUHAMAD RIDHO AULIA ALIF ALAMSYAH': createStudent('X 2'),
            'MUHAMMAD ALFARISI SUTRISNO': createStudent('X 2'),
            'NOVITA SAFIRA PUTRI': createStudent('X 2'),
            'PUTRI AMIROTUL LATHIFAH': createStudent('X 2'),
            'RIKA AODYA FATMAWATI': createStudent('X 2'),
            'RIRIS NUR AULIA AZZAHRAH': createStudent('X 2'),
            'HIFZIN YASID AL SYA\'BANI': createStudent('X 2'),
            
            // Data from tableConvert.com_5pz1b2.html (XII 1)
            'AHMAD ALFARIFQY EL FATIH': createStudent('XII 1'),
            'AHMAD FAISAL ADI SAPUTRA': createStudent('XII 1'),
            'AHMAD KHARIM MUTATOHHIRIN': createStudent('XII 1'),
            'AJENG AYU SORAYA': createStudent('XII 1'),
            'AZKA NAURA': createStudent('XII 1'),
            'CHOIROTUN NI\'MAH': createStudent('XII 1'),
            'DIAN LAILATUL SAZKIA': createStudent('XII 1'),
            'DWI AMELIA ARYANI': createStudent('XII 1'),
            'ELVITA DWI RAHMA': createStudent('XII 1'),
            'FADHEA MIFTACH RIZKY ALIS TI\'ANAH': createStudent('XII 1'),
            'IQBAL ALIMUL FUAD': createStudent('XII 1'),
            'KHOIRUN NISA FEBRIANTI VALENTINA': createStudent('XII 1'),
            'KHOIRUNNISA\'': createStudent('XII 1'),
            'KHOLIFATUL LAILIYAH': createStudent('XII 1'),
            'KHOLILATUR ROHMANIYAH': createStudent('XII 1'),
            'LATIFATUL KHOFIFAH': createStudent('XII 1'),
            'MAULANA ZUHAD FATHURROHMAN': createStudent('XII 1'),
            'MOH. DIMAS FIRMANSYAH': createStudent('XII 1'),
            'MUHAMMAD NUZUL FADIL': createStudent('XII 1'),
            'NADIRA AFLAHAH ZAAHIROH': createStudent('XII 1'),
            'NAFIDATUS SAHIDA': createStudent('XII 1'),
            'NANDA AULIA MADJID': createStudent('XII 1'),
            'NAZIIHAH ROONA MARELLA': createStudent('XII 1'),
            'NUR FADLILAH': createStudent('XII 1'),
            'NUR SYAHRANI MAGHFIROH RAMADHANI': createStudent('XII 1'),
            'RISFANDI TRI ARDIANSYAH': createStudent('XII 1'),
            'RIZKY PUTRI AMEILIA DEWI': createStudent('XII 1'),
            'SITI ABIDAH ARDELIA': createStudent('XII 1'),
            'SITI ROIHATUS SHOLIHA': createStudent('XII 1'),
            'SYARIFAH ZAHARA': createStudent('XII 1'),
            'ZAHROTUL JANNAH': createStudent('XII 1'),
            'ZAURA ZAHARANI AULIA BILQIS': createStudent('XII 1'),
            'MOHAMMAD FADLIL AKBAR': createStudent('XII 1'),
            
            // Data from tableConvert.com_u64gv1.html (XII 2)
            'ABDULLAH HAMID AL-BASYARI': createStudent('XII 2'),
            'ADELLIA PUTRI RAMADHANI': createStudent('XII 2'),
            'AGNIYATUL MUTMA\'INNAH': createStudent('XII 2'),
            'AHMAD ZUSRIL DHINI ZAB': createStudent('XII 2'),
            'ALFIYYAH FEBRIANTI': createStudent('XII 2'),
            'AMIRA KHAIRUNNISA': createStudent('XII 2'),
            'AZZA WIRDANINGSIH': createStudent('XII 2'),
            'DEVINA AMELIA PUTRI': createStudent('XII 2'),
            'DINI NABILATUL AULIA': createStudent('XII 2'),
            'ENGGA AL MA\'ARIF': createStudent('XII 2'),
            'HILMY ABDULLAH NUR HAQIQI': createStudent('XII 2'),
            'MAYLA ALTHAFUNNISA\' AL CHUSAIN': createStudent('XII 2'),
            'MIFTAQUL AFSIYAH': createStudent('XII 2'),
            'MOH. KHOBDOTIR JABBAR': createStudent('XII 2'),
            'MOH. RIEF\'AN KHOIRON ROSICKY': createStudent('XII 2'),
            'MOH. RIZKI AGUS SAPUTRA': createStudent('XII 2'),
            'MUHAMMAD ALAWI': createStudent('XII 2'),
            'MUHAMMAD ALI HAIDAR RAMADLAN': createStudent('XII 2'),
            'MUHAMMAD DAFA AFRIYANTO': createStudent('XII 2'),
            'MUHAMMAD ZAKY MAULANA AQIL': createStudent('XII 2'),
            'NOVA AMELIA': createStudent('XII 2'),
            'QINARA SABILAL MILLAH': createStudent('XII 2'),
            'RIZKY INDRAWAN MAULANA': createStudent('XII 2'),
            'SITI NUR ASIYAH': createStudent('XII 2'),
            'TRI ALIF AKHMAD AFIANTO': createStudent('XII 2'),
            'WILDANIA HIKMATUL FARIKHA': createStudent('XII 2'),
            'ZULIYANA KHOIR': createStudent('XII 2'),
            'BILLQIES BAJROYEKTI MP.': createStudent('XII 2')
        };


        // Valid teacher codes
        const teacherCodes = ['SMANJAOKE123'];

        function showTab(tab) {
            // Hide all sections
            document.getElementById('publicSection').classList.add('hidden');
            document.getElementById('teacherSection').classList.add('hidden');
            document.getElementById('recapSection').classList.add('hidden');

            // Remove active class from all tabs
            document.getElementById('publicTab').classList.remove('bg-indigo-500', 'text-white');
            document.getElementById('teacherTab').classList.remove('bg-indigo-500', 'text-white');
            document.getElementById('recapTab').classList.remove('bg-indigo-500', 'text-white');
            
            document.getElementById('publicTab').classList.add('text-gray-600');
            document.getElementById('teacherTab').classList.add('text-gray-600');
            document.getElementById('recapTab').classList.add('text-gray-600');

            // Show selected section and activate tab
            if (tab === 'public') {
                document.getElementById('publicSection').classList.remove('hidden');
                document.getElementById('publicTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('publicTab').classList.remove('text-gray-600');
            } else if (tab === 'teacher') {
                document.getElementById('teacherSection').classList.remove('hidden');
                document.getElementById('teacherTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('teacherTab').classList.remove('text-gray-600');
            } else if (tab === 'recap') {
                document.getElementById('recapSection').classList.remove('hidden');
                document.getElementById('recapTab').classList.add('bg-indigo-500', 'text-white');
                document.getElementById('recapTab').classList.remove('text-gray-600');
                // BARU: Perbarui rekap setiap kali tab dibuka
                updateRecap();
            }
        }

        function verifyTeacher() {
            const code = document.getElementById('teacherCode').value;
            
            if (teacherCodes.includes(code)) {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('teacherPanel').classList.remove('hidden');
            } else {
                alert('❌ Kode akses tidak valid! (Demo: SMANJAOKE123)');
            }
        }

        function logout() {
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('teacherPanel').classList.add('hidden');
            document.getElementById('teacherCode').value = '';
        }

        // --- BARU: MODIFIKASI FUNGSI addViolation ---
        function addViolation(violationType, points) {
            const selectedStudent = document.getElementById('studentSelect').value;
            
            if (!selectedStudent) {
                alert('⚠️ Silakan pilih siswa terlebih dahulu!');
                return;
            }

            // Add points to student
            studentData[selectedStudent].points += points;
            // BARU: Lacak jenis pelanggaran
            studentData[selectedStudent].violations[violationType]++;
            
            // Update table
            renderStudentTable(); // Menggunakan nama fungsi baru
            
            // BARU: Update rekap secara real-time
            updateRecap();
            
            // Show success message
            showSuccessMessage(`Poin ${violationType} (+${points}) berhasil ditambahkan untuk ${selectedStudent}`);
        }

        // --- BARU: FUNGSI renderStudentTable (Menggantikan updateStudentTable) ---
        // Fungsi ini sekarang menangani pencarian dan pengelompokan
        function renderStudentTable() {
            const filter = document.getElementById('searchInput').value.toUpperCase();
            const tableBody = document.getElementById('studentTable');
            tableBody.innerHTML = '';

            // 1. Kelompokkan siswa berdasarkan kelas
            const groupedStudents = {};
            Object.keys(studentData).forEach(name => {
                const student = studentData[name];
                if (!groupedStudents[student.class]) {
                    groupedStudents[student.class] = [];
                }
                groupedStudents[student.class].push({ name, ...student });
            });

            // 2. Urutkan kelas (X, XI, XII)
            const classOrder = {'X': 1, 'XI': 2, 'XII': 3};
            const sortedClasses = Object.keys(groupedStudents).sort((a, b) => {
                const [prefixA] = a.split(' ');
                const [prefixB] = b.split(' ');
                
                const orderA = classOrder[prefixA] || 99;
                const orderB = classOrder[prefixB] || 99;

                if (orderA !== orderB) {
                    return orderA - orderB;
                }
                return a.localeCompare(b); // Urutkan sub-kelas (misal: X 1 vs X 2)
            });

            // 3. Render tabel
            sortedClasses.forEach(className => {
                // Tambahkan baris header kelas
                const classHeaderRow = document.createElement('tr');
                classHeaderRow.classList.add('bg-indigo-100', 'font-bold');
                classHeaderRow.innerHTML = `
                    <td colspan="4" class="border border-gray-300 px-4 py-3 text-indigo-900">${className}</td>
                `;
                tableBody.appendChild(classHeaderRow);

                // Urutkan siswa dalam kelas berdasarkan nama
                const studentsInClass = groupedStudents[className].sort((a, b) => a.name.localeCompare(b.name));

                let studentsFound = 0;
                studentsInClass.forEach(student => {
                    // Terapkan filter pencarian
                    if (student.name.toUpperCase().indexOf(filter) > -1) {
                        studentsFound++;
                        const row = document.createElement('tr');
                        
                        let status, statusClass;
                        if (student.points <= 10) {
                            status = 'Baik';
                            statusClass = 'bg-green-100 text-green-800';
                        } else if (student.points <= 20) {
                            status = 'Peringatan';
                            statusClass = 'bg-yellow-100 text-yellow-800';
                        } else {
                            status = 'Bermasalah';
                            statusClass = 'bg-red-100 text-red-800';
                        }

                        let pointsColor;
                        if (student.points <= 10) pointsColor = 'text-green-600';
                        else if (student.points <= 20) pointsColor = 'text-orange-600';
                        else pointsColor = 'text-red-600';

                        row.innerHTML = `
                            <td class="border border-gray-300 px-4 py-3">${student.name}</td>
                            <td class="border border-gray-300 px-4 py-3">${student.class}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center font-bold ${pointsColor}">${student.points}</td>
                            <td class="border border-gray-300 px-4 py-3 text-center">
                                <span class="${statusClass} px-2 py-1 rounded-full text-sm">${status}</span>
                            </td>
                        `;
                        
                        tableBody.appendChild(row);
                    }
                });

                // Sembunyikan header kelas jika tidak ada siswa yang cocok
                if (studentsFound === 0 && filter.length > 0) {
                    classHeaderRow.classList.add('hidden');
                }
            });
        }
        
        function populateStudentSelect() {
            const select = document.getElementById('studentSelect');
            select.innerHTML = '<option value="">-- Pilih Siswa --</option>'; // Hapus isi & tambahkan default

            // Urutkan nama siswa berdasarkan abjad
            const sortedNames = Object.keys(studentData).sort();

            sortedNames.forEach(name => {
                const student = studentData[name];
                const option = document.createElement('option');
                option.value = name;
                option.textContent = `${name} - ${student.class}`;
                select.appendChild(option);
            });
        }

        function showSuccessMessage(message) {
            const successMessage = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            
            successText.textContent = message;
            successMessage.classList.remove('hidden');
            successMessage.classList.add('pulse-animation');
            
            setTimeout(() => {
                successMessage.classList.add('hidden');
                successMessage.classList.remove('pulse-animation');
            }, 3000);
        }

        // --- FUNGSI DIMODIFIKASI: updateRecap ---
        // Sekarang juga mengisi tabel rekap detail
        function updateRecap() {
            let totalBaik = 0;
            let totalPeringatan = 0;
            let totalBermasalah = 0;

            const recapTotals = {
                'Terlambat': { count: 0, points: 0, pointValue: 2 },
                'Tidak Mengerjakan PR': { count: 0, points: 0, pointValue: 3 },
                'Mengganggu Kelas': { count: 0, points: 0, pointValue: 4 },
                'Tidak Berseragam': { count: 0, points: 0, pointValue: 5 },
                'Merokok': { count: 0, points: 0, pointValue: 10 },
                'Berkelahi': { count: 0, points: 0, pointValue: 15 }
            };

            // 1. Hitung total dari semua siswa
            Object.values(studentData).forEach(student => {
                // Hitung status
                if (student.points === 0) {
                    totalBaik++;
                } else if (student.points <= 10) {
                    totalBaik++;
                } else if (student.points <= 20) {
                    totalPeringatan++;
                } else {
                    totalBermasalah++;
                }

                // Hitung total pelanggaran
                Object.keys(student.violations).forEach(type => {
                    const count = student.violations[type];
                    if (count > 0) {
                        recapTotals[type].count += count;
                        recapTotals[type].points += count * recapTotals[type].pointValue;
                    }
                });
            });

            // 2. Terapkan total ke HTML Ringkasan
            document.getElementById('recapBaik').textContent = totalBaik;
            document.getElementById('recapPeringatan').textContent = totalPeringatan;
            document.getElementById('recapBermasalah').textContent = totalBermasalah;

            document.getElementById('recapTerlambatJumlah').textContent = recapTotals['Terlambat'].count;
            document.getElementById('recapTerlambatPoin').textContent = recapTotals['Terlambat'].points;
            document.getElementById('recapPRJumlah').textContent = recapTotals['Tidak Mengerjakan PR'].count;
            document.getElementById('recapPRPoin').textContent = recapTotals['Tidak Mengerjakan PR'].points;
            document.getElementById('recapSeragamJumlah').textContent = recapTotals['Tidak Berseragam'].count;
            document.getElementById('recapSeragamPoin').textContent = recapTotals['Tidak Berseragam'].points;
            document.getElementById('recapMenggangguJumlah').textContent = recapTotals['Mengganggu Kelas'].count;
            document.getElementById('recapMenggangguPoin').textContent = recapTotals['Mengganggu Kelas'].points;
            document.getElementById('recapMerokokJumlah').textContent = recapTotals['Merokok'].count;
            document.getElementById('recapMerokokPoin').textContent = recapTotals['Merokok'].points;
            document.getElementById('recapBerkelahiJumlah').textContent = recapTotals['Berkelahi'].count;
            document.getElementById('recapBerkelahiPoin').textContent = recapTotals['Berkelahi'].points;

            // --- 3. BARU: Populate Detail Rekap Table ---
            const detailTableBody = document.getElementById('recapDetailTableBody');
            detailTableBody.innerHTML = ''; // Kosongkan tabel
            
            let hasViolations = false;
            const sortedNames = Object.keys(studentData).sort();
            
            sortedNames.forEach(name => {
                const student = studentData[name];

                if (student.points > 0) { // Hanya tampilkan siswa yang punya poin
                    hasViolations = true;
                    
                    // Buat string detail pelanggaran
                    let violationString = Object.keys(student.violations)
                        .filter(type => student.violations[type] > 0)
                        .map(type => `${type} (x${student.violations[type]})`)
                        .join(', ');

                    const row = document.createElement('tr');
                    
                    let pointsColor;
                    if (student.points <= 10) pointsColor = 'text-green-600';
                    else if (student.points <= 20) pointsColor = 'text-orange-600';
                    else pointsColor = 'text-red-600';

                    row.innerHTML = `
                        <td class="border border-gray-300 px-4 py-3">${name}</td>
                        <td class="border border-gray-300 px-4 py-3">${student.class}</td>
                        <td class="border border-gray-300 px-4 py-3">${violationString}</td>
                        <td class="border border-gray-300 px-4 py-3 text-center font-bold ${pointsColor}">${student.points}</td>
                    `;
                    detailTableBody.appendChild(row);
                }
            });

            if (!hasViolations) {
                detailTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="border border-gray-300 px-4 py-3 text-center text-gray-500">
                            🎉 Tidak ada pelanggaran yang tercatat.
                        </td>
                    </tr>
                `;
            }
        }

        // --- FUNGSI BARU: downloadRecap ---
        // Mengunduh konten rekap sebagai file .doc
        function downloadRecap() {
            const content = document.getElementById('recapContent').innerHTML;
            
            let html = `<!DOCTYPE html><html lang="id"><head><meta charset="UTF-8">`;
            html += `<title>Rekap Kedisiplinan</title>`;
            html += `<style>
                body { font-family: Arial, sans-serif; margin: 20px; }
                table { border-collapse: collapse; width: 100%; margin-top: 20px; }
                th, td { border: 1px solid #999; padding: 8px; text-align: left; }
                th { background-color: #f0f0f0; }
                h2 { color: #333; }
                .grid { display: block; }
                .text-center { text-align: center; }
                .font-bold { font-weight: bold; }
                .mb-6 { margin-bottom: 24px; }
                button { display: none; } /* Sembunyikan tombol di file doc */
            </style>`;
            html += `</head><body>${content}</body></html>`;

            const blob = new Blob([html], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Rekap_Ringkasan_Kedisiplinan.doc';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- FUNGSI BARU: downloadDetailRecapAsCSV ---
        // Mengunduh rekap detail sebagai file .csv (untuk Excel)
        function downloadDetailRecapAsCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            
            // 1. Buat Header
            const headers = ["Nama Siswa", "Kelas", "Total Poin", "Detail Pelanggaran"];
            csvContent += headers.join(",") + "\r\n";

            // 2. Buat Baris Data
            const sortedNames = Object.keys(studentData).sort();
            
            sortedNames.forEach(name => {
                const student = studentData[name];

                if (student.points > 0) {
                    // Buat string detail pelanggaran
                    // Gunakan titik koma (;) sebagai pemisah internal agar tidak bentrok dengan koma CSV
                    let violationString = Object.keys(student.violations)
                        .filter(type => student.violations[type] > 0)
                        .map(type => `${type} (x${student.violations[type]})`)
                        .join('; '); 

                    // Enclose in quotes to handle potential commas
                    const row = [
                        `"${name}"`,
                        `"${student.class}"`,
                        student.points,
                        `"${violationString}"`
                    ];
                    csvContent += row.join(",") + "\r\n";
                }
            });

            // 3. Buat dan Trigger Download
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "rekap_detail_pelanggaran.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }


        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            renderStudentTable(); // Menggunakan nama fungsi baru
            populateStudentSelect();
            updateRecap(); // Inisialisasi data rekap saat halaman dimuat
        });
    </script>
</body>
</html>
     
